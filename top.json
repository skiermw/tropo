{"AWSTemplateFormatVersion": "2010-09-09", "Description": "Top-Level", "Resources": {"IAM": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": "https://s3.amazonaws.com/shelter-mutual-aws-tools-us-east-1/cloudformation/iam.json"}}, "TestCraft": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": "https://s3.amazonaws.com/shelter-mutual-aws-tools-us-east-1/cloudformation/craft.json", "Parameters": {"AmiId": "ami-b18c62da", "CraftElbSubnetAz3": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz3Id"]}, "ElbSecurityGroups": {"Fn::GetAtt": ["SecurityGroups", "Outputs.craftElbSecurityGroupId"]}, "InstanceSecurityGroups": {"Fn::GetAtt": ["SecurityGroups", "Outputs.craftSecurityGroupId"]}, "VpcZoneIdentifierAz1": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPrivateAz1Id"]}, "CraftElbSubnetAz1": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz1Id"]}, "CraftElbSubnetAz2": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz2Id"]}, "VpcZoneIdentifierAz2": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPrivateAz2Id"]}, "SnsTopic": {"Fn::GetAtt": ["SNS", "Outputs.PrimaryArn"]}, "Environment": "Test", "ElbName": "Test-Craft-Elb", "IamInstanceProfile": {"Fn::GetAtt": ["IAM", "Outputs.craftInstanceProfile"]}, "InstanceType": "t2.micro", "VpcZoneIdentifierAz3": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPrivateAz3Id"]}}}}, "Network": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": "https://s3.amazonaws.com/shelter-mutual-aws-tools-us-east-1/cloudformation/network.json"}}, "Bastion": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": "https://s3.amazonaws.com/shelter-mutual-aws-tools-us-east-1/cloudformation/bastion.json", "Parameters": {"AmiId": {"Fn::FindInMap": ["AmznLinux", {"Ref": "AWS::Region"}, "HVMwithEBS"]}, "InstanceSecurityGroups": {"Fn::GetAtt": ["SecurityGroups", "Outputs.BastionSecurityGroupId"]}, "VpcZoneIdentifierAz1": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz1Id"]}, "VpcZoneIdentifierAz3": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz3Id"]}, "VpcZoneIdentifierAz2": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz2Id"]}, "SnsTopic": {"Fn::GetAtt": ["SNS", "Outputs.PrimaryArn"]}, "IamInstanceProfile": {"Fn::GetAtt": ["IAM", "Outputs.BastionInstanceProfile"]}}}}, "SecurityGroups": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": "https://s3.amazonaws.com/shelter-mutual-aws-tools-us-east-1/cloudformation/security_groups.json", "Parameters": {"VpcId": {"Fn::GetAtt": ["Network", "Outputs.VpcId"]}}}}, "SNS": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": "https://s3.amazonaws.com/shelter-mutual-aws-tools-us-east-1/cloudformation/sns.json"}}, "Nat": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": "https://s3.amazonaws.com/shelter-mutual-aws-tools-us-east-1/cloudformation/nat.json", "Parameters": {"AmiId": {"Fn::FindInMap": ["AmznLinux", {"Ref": "AWS::Region"}, "HVMwithEBS"]}, "InstanceSecurityGroups": {"Fn::GetAtt": ["Network", "Outputs.NatSecurityGroupId"]}, "VpcZoneIdentifierAz1": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz1Id"]}, "VpcZoneIdentifierAz3": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz3Id"]}, "VpcZoneIdentifierAz2": {"Fn::GetAtt": ["Network", "Outputs.SubnetTestPublicAz2Id"]}, "SnsTopic": {"Fn::GetAtt": ["SNS", "Outputs.PrimaryArn"]}, "IamInstanceProfile": {"Fn::GetAtt": ["IAM", "Outputs.NatInstanceProfile"]}, "InstanceType": "m3.medium"}}}}, "Mappings": {"CentOS7": {"us-east-1": {"HVM": "ami-61bbf104"}, "ap-northeast-1": {"HVM": "ami-d38dc6e9"}, "sa-east-1": {"HVM": "ami-fd0197e0"}, "ap-southeast-1": {"HVM": "ami-2a7b6b78"}, "ap-southeast-2": {"HVM": "ami-b80b6db8"}, "us-west-2": {"HVM": "ami-d440a6e7"}, "us-west-1": {"HVM": "ami-f77fbeb3"}, "eu-central-1": {"HVM": "ami-33734044"}, "eu-west-1": {"HVM": "ami-e68f82fb"}}, "AmznLinux": {"us-east-1": {"HVMwithEBS": "ami-e3106686", "HVM": "ami-65116700", "PVwithEBS": "ami-cf1066aa", "PV": "ami-971066f2"}, "ap-northeast-1": {"HVMwithEBS": "ami-9a2fb89a", "HVM": "ami-a22fb8a2", "PVwithEBS": "ami-9c2fb89c", "PV": "ami-a42fb8a4"}, "sa-east-1": {"HVMwithEBS": "ami-3b0c9926", "HVM": "ami-030c991e", "PVwithEBS": "ami-370c992a", "PV": "ami-010c991c"}, "ap-southeast-1": {"HVMwithEBS": "ami-52978200", "HVM": "ami-ac9481fe", "PVwithEBS": "ami-50978202", "PV": "ami-4c97821e"}, "ap-southeast-2": {"HVMwithEBS": "ami-c11856fb", "HVM": "ami-871856bd", "PVwithEBS": "ami-c71856fd", "PV": "ami-851856bf"}, "us-west-2": {"HVMwithEBS": "ami-9ff7e8af", "HVM": "ami-bbf7e88b", "PVwithEBS": "ami-81f7e8b1", "PV": "ami-bdf7e88d"}, "us-west-1": {"HVMwithEBS": "ami-cd3aff89", "HVM": "ami-c33aff87", "PVwithEBS": "ami-d53aff91", "PV": "ami-c93aff8d"}, "eu-central-1": {"HVMwithEBS": "ami-daaeaec7", "HVM": "ami-a2aeaebf", "PVwithEBS": "ami-a6aeaebb", "PV": "ami-a0aeaebd"}, "eu-west-1": {"HVMwithEBS": "ami-69b9941e", "HVM": "ami-7db9940a", "PVwithEBS": "ami-a3be93d4", "PV": "ami-8fbe93f8"}}, "UbuntuTrusty": {"us-east-1": {"HVMwithEBS": "ami-ff02509a", "HVM": "ami-b91042dc", "PVwithEBS": "ami-e902508c", "PV": "ami-11f9aa74"}, "ap-northeast-1": {"HVMwithEBS": "ami-402e4c40", "HVM": "ami-ee294bee", "PVwithEBS": "ami-362e4c36", "PV": "ami-32254732"}, "sa-east-1": {"HVMwithEBS": "ami-1f4bda02", "HVM": "ami-8348d99e", "PVwithEBS": "ami-e148d9fc", "PV": "ami-cf49d8d2"}, "ap-southeast-1": {"HVMwithEBS": "ami-42170410", "HVM": "ami-a01003f2", "PVwithEBS": "ami-54170406", "PV": "ami-2e11027c"}, "ap-southeast-2": {"HVMwithEBS": "ami-6d6c2657", "HVM": "ami-016c263b", "PVwithEBS": "ami-776c264d", "PV": "ami-c96e24f3"}, "us-west-2": {"HVMwithEBS": "ami-8ee605bd", "HVM": "ami-e8e102db", "PVwithEBS": "ami-82e605b1", "PV": "ami-aa9a7999"}, "us-west-1": {"HVMwithEBS": "ami-198a495d", "HVM": "ami-2f8b486b", "PVwithEBS": "ami-138a4957", "PV": "ami-c7864583"}, "eu-central-1": {"HVMwithEBS": "ami-46272b5b", "HVM": "ami-90262a8d", "PVwithEBS": "ami-48272b55", "PV": "ami-84252999"}, "eu-west-1": {"HVMwithEBS": "ami-37360a40", "HVM": "ami-fb38048c", "PVwithEBS": "ami-5b360a2c", "PV": "ami-91437fe6"}}}}